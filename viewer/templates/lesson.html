{% extends "base.html" %}
{% from "macros/icons.html" import icon %}

{% block title %}{{ title }} - Study Viewer{% endblock %}

{% block header %}
<nav class="breadcrumb">
    <a href="{{ url_for('index', lang=lang) }}">Topics</a>
    <span class="separator">/</span>
    <a href="{{ url_for('topic', lang=lang, name=topic) }}">{{ topic.replace('_', ' ') }}</a>
    <span class="separator">/</span>
    <span class="current">{{ title }}</span>
</nav>
{% endblock %}

{# Unified toolbar macro: renders nav + actions at both top and bottom #}
{% macro lesson_toolbar(position) %}
<div class="lesson-toolbar lesson-toolbar--{{ position }}">
    <div class="toolbar-nav toolbar-nav--prev">
        {% if prev_lesson %}
        <a href="{{ url_for('lesson', lang=lang, name=topic, filename=prev_lesson.filename) }}" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">{{ prev_lesson.title or prev_lesson.display_name }}</span>
        </a>
        {% else %}
        <span class="nav-placeholder"></span>
        {% endif %}
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-read {% if is_read %}active{% endif %}" data-action="mark-read" title="Mark as read" aria-pressed="{{ 'true' if is_read else 'false' }}">
            <span class="icon"><span class="icon-check">{{ icon('check', 16) }}</span><span class="icon-circle">{{ icon('circle', 16) }}</span></span>
            <span class="text">{% if is_read %}Read{% else %}Mark as read{% endif %}</span>
        </button>
        <button class="btn btn-bookmark {% if is_bookmarked %}active{% endif %}" data-action="bookmark" title="Bookmark" aria-pressed="{{ 'true' if is_bookmarked else 'false' }}">
            <span class="icon">{{ icon('bookmark', 16) }}</span>
            <span class="text">{% if is_bookmarked %}Bookmarked{% else %}Bookmark{% endif %}</span>
        </button>
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">{{ icon('link', 16) }}</span>
            <span class="text">Copy link</span>
        </button>
        <a href="{{ url_for('topic', lang=lang, name=topic) }}" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">{{ icon('list', 16) }}</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        {% if next_lesson %}
        <a href="{{ url_for('lesson', lang=lang, name=topic, filename=next_lesson.filename) }}" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">{{ next_lesson.title or next_lesson.display_name }}</span>
        </a>
        {% endif %}
    </div>
</div>
{% endmacro %}

{% block content %}
<article class="lesson-article" data-lang="{{ lang }}" data-topic="{{ topic }}" data-filename="{{ filename }}">
    <header class="lesson-header">
        <h1>{{ title }}</h1>
    </header>

    {{ lesson_toolbar('top') }}

    {% if toc %}
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        {{ toc|safe }}
    </nav>
    {% endif %}

    <div class="lesson-content markdown-body">
        {{ content|safe }}
    </div>

    {{ lesson_toolbar('bottom') }}

    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">&uarr;</button>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/lesson.js') }}"></script>
{% endblock %}
