{% extends "base.html" %}

{% block title %}Search{% if query %}: {{ query }}{% endif %} - Study Viewer{% endblock %}

{% block header %}
<h1>Search</h1>
{% endblock %}

{% block content %}
<div class="search-page">
    <form action="{{ url_for('search_page', lang=lang) }}" method="get" class="search-form">
        <div class="search-input-row">
            <label for="search-input" class="sr-only">Search</label>
            <input type="search" id="search-input" name="q" value="{{ query }}" placeholder="Search lessons and examples..." autofocus>
            <button type="submit">Search</button>
        </div>
        <div class="search-filters">
            <select name="topic" class="search-filter-select" aria-label="Filter by topic">
                <option value="">All topics</option>
                {% for t in topics %}
                <option value="{{ t.name }}" {% if topic_filter == t.name %}selected{% endif %}>{{ t.display_name }}</option>
                {% endfor %}
            </select>
            <select name="type" class="search-filter-select" aria-label="Filter by content type">
                <option value="" {% if not type_filter %}selected{% endif %}>All types</option>
                <option value="lesson" {% if type_filter == 'lesson' %}selected{% endif %}>Lessons</option>
                <option value="example" {% if type_filter == 'example' %}selected{% endif %}>Examples</option>
            </select>
        </div>
    </form>

    {% if query %}
    <div class="search-results">
        <p class="results-count">{{ results|length }} result{{ 's' if results|length != 1 else '' }} for "{{ query }}"</p>

        {% if results %}
        <div class="results-list">
            {% for result in results %}
            {% if result.content_type == 'example' %}
            <a href="{{ url_for('example_view', lang=lang, topic_name=result.topic, filepath=result.filename) }}" class="result-item">
            {% else %}
            <a href="{{ url_for('lesson', lang=lang, name=result.topic, filename=result.filename) }}" class="result-item">
            {% endif %}
                <div class="result-header">
                    <span class="result-topic">{{ result.topic.replace('_', ' ') }}</span>
                    <span class="result-type-badge result-type-{{ result.content_type }}">{{ result.content_type }}</span>
                    <h3 class="result-title">{{ result.title }}</h3>
                </div>
                <p class="result-snippet">{{ result.snippet|safe }}</p>
            </a>
            {% endfor %}
        </div>
        {% else %}
        <div class="no-results">
            <p>No results found. Try different keywords or use quotes for exact phrase matching.</p>
        </div>
        {% endif %}
    </div>
    {% else %}
    <div class="search-hint">
        <p>Search across lessons and example code. Enter at least 2 characters. Use quotes for exact phrase matching.</p>
    </div>
    {% endif %}
</div>
{% endblock %}
