# 우주 기상을 위한 AI/ML

## 학습 목표

- AI/ML 방법이 우주 기상 예측에 적합한 이유와 이 분야가 제시하는 고유한 도전 과제를 이해한다
- LSTM 기반 Dst 예측과 물리 기반 경험적 모델을 비교하고 설명한다
- 태양 플레어 예측을 위해 자기도 기반 특징과 CNN이 어떻게 활용되는지 기술한다
- 태양 에너지 입자(SEP) 사건 예측의 도전 과제와 현재 ML 접근법을 분석한다
- 신경망을 이용한 복사대 현재 상태 분석(nowcasting)과 데이터 동화의 역할을 이해한다
- CME 자기장 방향($B_z$) 도착 전 예측이라는 "성배 문제"를 논의한다
- 물리 정보 신경망(PINN)과 하이브리드 모델링 전략을 평가한다
- 우주 기상 ML에서의 모범 사례: 클래스 불균형, 비정상성, 해석 가능성 처리를 식별한다

---

## 1. 왜 우주 기상에 AI/ML인가?

우주 기상은 본질적으로 복잡하고 비선형적인 다중 스케일 물리 시스템과 관련된 예측 문제다. 태양-지구 시스템은 공간 스케일에서 12차수(운동론적 플라즈마 과정의 ~km에서 태양권 구조의 ~AU까지)를 아우르며 준정상 상태부터 폭발적 거동까지 다양한 양상을 보인다. 이러한 복잡성 덕분에 우주 기상은 머신 러닝의 매력적인 대상이 된다.

### 1.1 ML의 적합성

**비선형성과 복잡성.** 자기권의 태양풍 구동에 대한 반응은 매우 비선형적이다. 동일한 태양풍 조건이라도 전제 조건(사전 서브스톰 활동, 플라즈마권 상태, 고리 전류 조성)에 따라 극적으로 다른 지자기 반응을 낼 수 있다. 물리 기반 모델은 이 모든 상호 의존성을 동시에 포착하는 데 어려움을 겪는다. ML 모델은 원칙적으로 데이터로부터 이러한 복잡한 입출력 관계를 학습할 수 있다.

**물리 모델의 계산 비용.** 단일 ENLIL+SWMF 시뮬레이션 체인은 슈퍼컴퓨터에서 수 시간이 걸릴 수 있다. 운영 예보(수 분 안에 결정을 내려야 함)와 앙상블 예보(수백 회 실행 필요)에는 이것이 너무 느리다. 학습된 신경망은 밀리초 단위로 예측을 생성한다.

**풍부한 관측 데이터.** 우주 시대는 방대한 데이터셋을 생산했다:
- SDO는 하루 ~1.5 TB의 태양 이미지를 생성
- OMNI는 60년 이상 연속 태양풍 데이터를 제공
- SuperMAG은 300개 이상의 관측소에서 자기장 데이터를 저장
- 반알렌 탐사선은 7년간 복사대 측정 제공

이러한 데이터셋은 데이터를 많이 필요로 하는 ML 모델 훈련에 이상적이다.

**패턴 인식.** 일부 우주 기상 현상은 물리 모델로 인코딩하기 어렵지만 잠재적으로 학습 가능한 패턴을 포함한다. 예를 들어, 플레어 전 수 시간 동안 활성 영역 자기장의 형태적 진화 — 복잡성과 전단(shear)의 미묘한 변화 — 는 완전한 MHD 방정식을 풀기보다 CNN으로 더 효율적으로 포착될 수 있다.

### 1.2 우주 기상 고유의 도전 과제

이러한 장점에도 불구하고, 우주 기상은 일반적인 ML 응용과 구별되는 도전 과제를 제시한다:

**희귀 극단 사건.** 가장 중요한 사건들(극단적 폭풍, 대규모 SEP 사건, X급 플레어)이 가장 드물다. 1960-2025년에 걸친 데이터셋에는 약 10-15건의 초강력 폭풍(Dst < $-250$ nT), 50-60건의 X급 플레어, 5-6건의 극단적 SEP 사건이 있을 뿐이다. 이 심각한 클래스 불균형 때문에 "사건 없음"을 항상 예측하는 모델이 99% 이상의 정확도를 달성하면서도 가장 중요한 사건에 대해서는 완전히 쓸모없게 된다.

**비정상성(Non-stationarity).** 태양은 11년 주기로 변한다. 태양 극대기와 극소기는 활성 영역 형태, CME 발생률, 태양풍 구조가 다르다. 태양 주기 23(1996-2008)으로 훈련된 모델은 주기 24(2008-2019)나 주기 25(2019-현재)로 일반화되지 않을 수 있다. 게다가 시간이 지남에 따라 계측기와 데이터 품질이 변한다(새 위성, 퇴역한 센서).

**제한된 훈련 데이터.** 우리는 약 4-5개의 고품질 다중 파라미터 데이터 태양 주기를 보유하고 있다(~1970년대 이후). 일부 측정(예: SDO 자기도)은 단 한 번의 태양 주기(2010년 이후)에 불과하다. 이를 날씨 예보와 비교하면: 70년 이상의 라디오존데 데이터, 40년 이상의 위성 데이터, 연간이 아닌 하루에 여러 건의 사건이 있다.

**물리적 제약.** 우주 기상 예측은 보존 법칙, 인과성, 알려진 물리를 준수해야 한다. 순수 데이터 기반 모델은 에너지 보존을 위반하거나 원인보다 결과를 먼저 예측하는 출력을 생성할 수 있다. 물리 정보 접근법이 이를 해결한다.

---

## 2. Dst 예측

태양풍 측정값으로부터의 Dst 예측은 우주 기상 ML에서 가장 성숙한 응용 분야로, 새로운 방법들의 기준(벤치마크)으로 사용된다.

### 2.1 물리 기반 기준선: 버튼 방정식

ML 접근법을 논의하기 전에, 이들이 넘어야 할 기준을 알아야 한다. 버튼 방정식(1975)은 Dst를 구동-소산 시스템으로 모델링한다:

$$\frac{d\text{Dst}^*}{dt} = Q(t) - \frac{\text{Dst}^*}{\tau}$$

여기서 $\text{Dst}^* = \text{Dst} - b\sqrt{P_{\text{dyn}}} + c$는 압력 보정된 Dst이고:

$$Q = \begin{cases} a(E_y - E_c) & \text{if } E_y > E_c \\ 0 & \text{otherwise} \end{cases}$$

여기서 $E_y = -v B_z$(새벽-황혼 전기장, GSM에서 $B_z$), $E_c \approx 0.5$ mV/m는 결합 임계값, $a \approx -4.5$ nT/(mV/m $\cdot$ hr)는 주입 효율, $\tau \approx 7.7$ hr는 회복 시정수이다.

버튼 모델은 본질적인 물리를 포착한다: 주간 재연결에 의한 에너지 주입(남향 전기장에 비례)과 전하 교환 및 쿨롱 충돌에 의한 에너지 손실(지수적 감쇠). 1시간 선행 예측에서 상관 $r \approx 0.85-0.90$을 달성한다.

오브라이언-맥피트리지(O'Brien-McPhetridge, 2000) 개선은 $\tau$를 활동 의존적으로 만든다: $\tau = 2.4 \exp(9.74 / (4.69 + E_y))$ 시간, 회복 단계 예측을 개선한다.

### 2.2 Dst를 위한 LSTM

장단기 메모리(LSTM) 네트워크는 자기권의 반응이 현재 값만이 아니라 태양풍 입력의 시간 이력에 의존하기 때문에 Dst 예측의 자연스러운 후보다.

**입력 특징** (OMNI 데이터에서, 1분 또는 5분 해상도):
- 태양풍 속도 $v$ (km/s)
- 양성자 밀도 $n$ (cm$^{-3}$)
- IMF 크기 $B$와 $B_z$ 성분 (nT, GSM)
- 동압 $P_{\text{dyn}}$ (nPa)
- 새벽-황혼 전기장 $E_y$ (mV/m)
- 선택 사항: Newell 결합 함수 $d\Phi_{MP}/dt$, 엡실론 파라미터

**아키텍처:**
- 입력: 태양풍 데이터의 슬라이딩 윈도우(예: 5분 간격 24시간 = 288 타임스텝 $\times$ 6 특징)
- 1-2개 LSTM 레이어(64-128 은닉 유닛)
- 드롭아웃(0.2-0.3): 정규화
- 완전 연결 레이어(들): 출력
- 출력: $\Delta t = 1, 2, 3, 6$시간 각각에 대한 시간 $t + \Delta t$의 Dst

**훈련 설정:**
- 데이터: OMNI 시간별 또는 5분 데이터, 1995-2015 훈련용, 2015-2020 테스트용
- 정규화: 각 특징에 StandardScaler 또는 MinMaxScaler 적용
- 손실 함수: MSE, 때로는 폭풍 기간에 더 높은 가중치 부여
- 최적화기: Adam, 학습률 ~$10^{-3}$ (감쇠 포함)
- 검증 손실에 대한 조기 종료

**성능:**

| 예보 리드 타임 | RMSE (nT) | 상관 | 비고 |
|-----------|-----------|-------------|-------|
| 1시간 | 8-12 | 0.93-0.97 | 최고 물리 모델과 동등 |
| 3시간 | 12-18 | 0.85-0.92 | 버튼 방정식 초과 |
| 6시간 | 18-25 | 0.75-0.85 | 유용하나 성능 저하 |

버튼 방정식 대비 LSTM의 장점은 다중 주입이 있는 복잡한 폭풍과 회복 단계에서 가장 두드러지며, 비선형 감쇠가 학습된 표현으로 더 잘 포착된다.

### 2.3 트랜스포머 모델

어텐션 기반 트랜스포머 모델도 Dst 예측에서 가능성을 보여주었다:

- **자기 어텐션(Self-attention)**은 모델이 LSTM의 고정 메모리 구조에 의존하는 대신 현재 출력 예측에 가장 관련된 과거 타임스텝을 학습할 수 있게 해준다.
- 어텐션 가중치는 해석 가능하다: 폭풍 시작 시 모델은 지속적인 남향 $B_z$ 기간에 강하게 집중하고, 회복 시에는 폭풍 최솟값에 집중한다.
- 성능은 LSTM과 동등하거나 약간 더 우수하며, 병렬화된 훈련(GPU에서 더 빠름)이라는 장점이 있다.

### 2.4 신경 ODE

더 새로운 접근법은 Dst 역학을 신경 상미분 방정식으로 인코딩한다:

$$\frac{d\mathbf{h}}{dt} = f_\theta(\mathbf{h}, \mathbf{x}(t))$$

여기서 $\mathbf{h}$는 은닉 상태, $\mathbf{x}(t)$는 태양풍 입력, $f_\theta$는 파라미터 $\theta$를 가진 신경망이다. 이 공식화는 불규칙한 시간 샘플링을 자연스럽게 처리하고 연속 시간 예측을 생성한다. ODE 구조는 또한 모델이 버튼 방정식과 유사한 역학을 학습하도록 유도하여 암묵적인 물리 정규화를 제공한다.

---

## 3. 플레어 예측

태양 플레어 예측은 분류 문제다: 현재 태양 상태에서 다음 24시간 내에 M급 이상의 플레어가 발생하는가?

### 3.1 특징 기반 접근법

SDO/HMI 계측기는 SHARP(Space-weather HMI Active Region Patches)를 생성한다 — 각 활성 영역을 감싸는 사전 계산된 자기장 파라미터를 가진 절단 영역:

**주요 SHARP 특징:**
- 총 비부호화 자기 플럭스: $\Phi = \int |B_r| dA$
- R값(Schrijver): 강한 기울기 극성 반전선 근처의 비부호화 플럭스
- 총 전류 나선도: $H_c = \int B_z (\nabla \times \mathbf{B})_z dA$
- 총 광구 자기 자유 에너지 프록시
- PIL을 따른 $B_{\text{hor}}$의 기울기 가중 적분
- 강한 자기장 영역의 면적

**랜덤 포레스트 분류기:**
- 입력: 각 활성 영역에 대한 ~20개 SHARP 특징
- 출력: 24시간 내 M+ 플레어 확률
- 장점: 빠르고 해석 가능(특징 중요도를 통해 R값, 총 비부호화 플럭스, 자유 에너지 프록시가 상위 예측자임을 알 수 있음)
- 성능: TSS ~ 0.5-0.7(훈련 데이터셋과 사건 정의에 따라 다름)

이 특징들의 물리적 직관은 플레어가 비포텐셜(비틀리고 전단된) 자기장 배형에 저장된 자기 자유 에너지에 의해 구동된다는 것이다. 극성 반전선 위의 자유 에너지가 클수록 플레어 가능성이 높다.

### 3.2 자기도의 CNN

특징을 수동으로 설계하는 대신, 합성곱 신경망(CNN)이 자기도 이미지에서 직접 학습할 수 있다:

**아키텍처:**
- 입력: $256 \times 256$ HMI 시선 방향 또는 벡터 자기도 패치
- 백본: ResNet-18 또는 VGG 유사 아키텍처
- 출력: 이진 확률(24시간 내 M+ 플레어)
- 훈련: 클래스 불균형 해결을 위한 균형 샘플링 또는 가중 손실(~100 활성 영역-일 당 M-플레어 1건)

**성능:** 최고의 연구에서 TSS ~ 0.6-0.8로, 특징 기반 방법보다 다소 우수하다. CNN은 스칼라 SHARP 파라미터로 완전히 표현되지 않는 공간적 패턴(예: 극성 반전선의 형태, 자기장 혼합 정도)을 포착할 가능성이 있다.

**Grad-CAM 시각화**는 CNN이 복잡한 자기 극성 영역에 주의를 집중한다는 것을 보여준다 — 정확히 플레어 발생 플럭스 출현과 소멸이 일어나는 위치다. 이는 모델이 인공물이 아닌 물리적으로 의미 있는 패턴을 학습하고 있다는 확신을 준다.

### 3.3 멀티모달 및 시간적 모델

최신 접근법은 여러 데이터 소스를 결합하고 시간적 진화를 활용한다:

- **멀티모달:** SHARP 스칼라 특징 + 자기도 이미지 + AIA EUV 이미지(코로나 구조를 보여줌). 후기 융합(late fusion) 또는 교차 어텐션 메커니즘이 서로 다른 모달리티의 정보를 결합한다.
- **비디오 모델:** 자기도 시퀀스의 3D CNN 또는 ConvLSTM(예: 시간별 이미지 24시간). 이는 플레어 전에 나타나는 자기장의 시간적 진화 — 플럭스 출현, 전단 증가, 소멸 — 를 포착한다.
- **결과:** 멀티모달 및 시간적 모델은 점진적인 개선(TSS ~ 0.7-0.85)을 보이지만 향상 폭이 제한적이어서, 광구 관측만으로는 예측 가능성의 한계에 근접하고 있음을 시사한다. 코로나 정보(자기장 위상, 필라멘트 존재 여부)가 돌파구가 될 수 있다.

### 3.4 플레어 예측의 한계

플레어 예측에 근본적인 정확도 한계가 있는지에 대한 논의가 계속되고 있다. 그렇다고 시사하는 여러 논거가 있다:

- 플레어는 광구 관측으로는 본질적으로 예측 불가능한 확률적 과정(예: 응력 자기장과 상호작용하는 난류 대류 운동)에 의해 촉발될 수 있다.
- 준안정 상태에서 폭발 상태로의 전환은 광구에서 관측할 수 없는 코로나 파라미터에 의존할 수 있다.
- 과거 TSS 점수는 점점 더 정교한 모델에도 불구하고 ~0.7-0.8에서 정체되었다.

이것이 ML이 쓸모없다는 뜻은 아니다 — 불완전한 확률 예보도 위험 관리에 가치가 있다 — 하지만 현실적인 기대치를 설정한다.

---

## 4. SEP 사건 예측

### 4.1 문제

태양 에너지 입자(SEP) 사건은 우주인과 우주선에 직접적인 방사선 위험을 초래한다. 이를 예측하려면 세 가지 질문에 답해야 한다: 사건이 발생하는가? 강도가 얼마나 되는가? 얼마나 지속되는가?

**태양 사건 발생 시 이용 가능한 입력:**
- 플레어 위치(경도, 위도) 및 크기(GOES X선 등급)
- CME 속도, 폭, 방향(코로나그래프 이미지에서, 폭발 후 ~30-60분에 확보)
- 타입 II 및 타입 III 전파 버스트 특성(CME 구동 충격파와 전자 빔의 지표)
- 이전 SEP 사건 이력(씨앗 입자 집단)

### 4.2 ML 접근법

**발생에 대한 로지스틱 회귀:** 단순하지만 놀랍도록 효과적인 기준선. 핵심 특징: 플레어 경도(서반구 플레어는 지구와 자기적으로 연결됨), CME 속도, 타입 II 전파 버스트 존재 여부. POD ~ 0.7-0.8, FAR ~ 0.3-0.4 달성.

**최대 플럭스에 대한 랜덤 포레스트:** 플레어와 CME 특징을 결합하여 $\log_{10}(\text{peak flux})$를 연속 변수로 예측한다. 특징 중요도: CME 속도와 폭이 지배적이고, 플레어 등급과 경도가 그 뒤를 잇는다.

**PROSPER (NOAA):** 경험적 관계와 ML을 결합하여 태양 사건 후 ~30분 내에 SEP 사건 확률, 발생 시간, 최대 플럭스의 확률 예보를 제공하는 운영 SEP 예측 도구.

**경보 시간:** SEP 예측의 근본적인 제약은 가장 빠른 입자(준상대론적 양성자)가 개시 태양 사건 후 ~10-30분 만에 지구에 도착한다는 것이다. 폭발 순간부터 완벽한 예측이 있어도 의사 결정에 거의 시간이 없다. 폭발 전 예측(플레어 전 SEP 사건 예보)은 여전히 매우 어렵다.

---

## 5. 복사대 현재 상태 분석(Nowcasting)

### 5.1 목표

드문 위성 측정 사이의 간격을 채워 모든 L-셸(L-shell)과 에너지에서 복사대 전자 플럭스를 실시간으로 추정한다.

### 5.2 신경망 매핑

가장 단순한 접근법은 지자기 지수에서 전자 플럭스로의 매핑을 학습한다:

**입력:** 직전 수 일간(예: 72시간)의 Kp(또는 AE, Dst) 시계열

**출력:** $\log_{10}(j)$ (여기서 $j$는 지정된 $L$-셸과 에너지에서의 전자 미분 플럭스)

**아키텍처:** 반알렌 탐사선 또는 GOES 데이터로 훈련된 피드포워드 네트워크 또는 LSTM

**물리적 근거:** 지자기 지수는 파동 활동의 이력(전자를 가속하고 산란시키는)과 태양풍 구동(방사상 확산을 제어하는)을 인코딩한다. 신경망은 지수-플럭스 상관으로부터 포커-플랑크 역학을 암묵적으로 학습한다.

### 5.3 주요 결과

링(Ling) 등은 1-3일 리드 타임에서 지속성("오늘과 같은 내일" 예보)을 능가하는 정지 궤도에서의 >2 MeV 전자 플럭스 LSTM 기반 예보를 시연했다. 모델은 다음을 성공적으로 포착한다:
- 증가 사건(고속 스트림 도착 후 점진적 플럭스 증가)
- 폭풍 시간 급감(자기권계면 음영에 의한 빠른 플럭스 감소)
- 폭풍 후 회복

주요 실패 모드는 급감 사건으로, 플럭스가 몇 시간 만에 수십 자릿수로 감소할 수 있다. 이는 정지 궤도 내부로의 자기권계면 압축을 포함하는 — 모델의 훈련 예제가 제한된 비교적 드문 기하학적 상황이다.

### 5.4 데이터 동화

더 정교한 접근법은 데이터 동화를 통해 물리 모델과 관측을 결합한다:

1. 복사대 물리 모델(예: VERB-4D)을 시간 순으로 실행한다.
2. 위성 측정이 확보되면 칼만 필터 또는 앙상블 조정을 사용하여 모델 상태를 수정한다.
3. 수정된 상태에서 예보를 계속한다.

이 접근법은 물리 모델의 공간 구조(L과 에너지에 따른 플럭스 변화 방식을 앎)를 활용하면서 관측을 통해 모델 오차를 수정한다. 측정 간격을 자연스럽게 처리하고 불확실성 추정을 제공한다.

---

## 6. CME 도착 시간과 $B_z$ 예측

### 6.1 ML을 이용한 CME 통과 시간

항력 기반 모델은 CME 전파에 대한 물리 프레임워크를 제공하지만, 항력 계수 $\gamma$는 사건마다 다르다. ML은 역사적 CME-ICME 쌍으로부터 $\gamma$(또는 도착 시간 직접)를 학습할 수 있다:

**특징:**
- CME 초기 속도(코로나그래프로부터)
- CME 각폭
- CME 발원 위치
- 배경 태양풍 속도(WSA 또는 L1에서 관측)
- 이전 CME 활동(태양권의 전제 조건)

**방법:** 알려진 도착 시간을 가진 ~200-400건의 CME 사건 카탈로그로 훈련된 랜덤 포레스트, 그래디언트 부스팅, 또는 신경망.

**결과:** 평균 절대 오차 ~10-12시간으로 ENLIL과 동등하지만 초 단위로 계산된다. ML의 장점은 대규모 앙상블을 손쉽게 실행할 수 있다는 것이다.

### 6.2 $B_z$ 도전 과제

지구 도착 전에 CME 내부의 자기장 남북 성분($B_z$, GSM 좌표)을 예측하는 것은 우주 기상 예보에서 가장 중요한 미해결 문제다. 이유: 지자기 폭풍 강도는 남향 $B_z$(주간 재연결을 구동함)에 결정적으로 의존하지만, 지구에서의 $B_z$는 코로나그래프 이미지로 직접 관측할 수 없는 CME 내부 자기장 구조에 달려 있다.

**현재 접근법:**

1. **발원 지역에서의 핸디드니스(Handedness):** CME 자속 로프의 자기 나선도는 발원 활성 영역의 나선도와 관련되어 있다(반구 나선도 규칙을 따름 — 북반구에서는 주로 음성, 남반구에서는 양성). 이는 로프의 비틀림을 알려주지만 기울기나 충격 매개변수는 알려주지 않으므로 $B_z$ 예측은 불확실하다.

2. **ML을 이용한 자속 로프 피팅:** CME 발원 지역 특성과 궤적이 주어지면, 지구에서의 자속 로프 방향을 예측한다. 최근 연구는 지상 진실을 아는 MHD 시뮬레이션 출력으로 훈련된 신경망을 사용한다. 정확도: 올바른 극성 약 50-60% — 어려운 문제를 고려하면 미미하지 않은 수치다.

3. **물리 정보 신경망(PINN):** 무전류 자속 로프 방정식 $\nabla \times \mathbf{B} = \alpha \mathbf{B}$를 제약 조건으로 강제하면서 관측된 CME 형태를 맞춘다. 이는 해 공간을 제한하고 일반화를 개선한다.

4. **DSCOVR 초기 분석:** CME 초기(sheath, 자기 이젝타보다 ~30-60분 앞서 L1 도착)가 도착하면, 초기 자기장 특성을 분석하여 이어지는 이젝타의 $B_z$를 추론한다. 이는 매우 짧은 리드 타임을 제공하지만 현재 이용 가능한 가장 신뢰할 수 있는 접근법이다.

근본적인 어려움은 $B_z$를 예측하는 데 필요한 정보 — CME 내부의 3차원 자기 위상 — 가 원격 감지로는 접근 불가능하다는 것이다. L5 같은 태양-지구 선을 벗어난 위치에서의 미래 탐사선은 CME 구조의 측면 뷰를 제공하여 도움이 될 수 있다.

---

## 7. 물리 정보 접근법

### 7.1 물리 정보 신경망(PINNs)

PINN(Physics-Informed Neural Networks)은 손실 함수에 물리 기반 항을 추가하여 알려진 물리를 신경망 훈련에 통합한다:

$$\mathcal{L} = \underbrace{\mathcal{L}_{\text{data}}}_{\text{관측값 맞추기}} + \lambda \underbrace{\mathcal{L}_{\text{physics}}}_{\text{방정식 만족}}$$

**예시: 복사대의 방사상 확산.**

지배 PDE는:

$$\frac{\partial f}{\partial t} = L^2 \frac{\partial}{\partial L}\left(\frac{D_{LL}}{L^2}\frac{\partial f}{\partial L}\right) - \frac{f}{\tau}$$

신경망 $f_\theta(L, t)$는 다음을 위해 훈련된다:
1. 위성 위치에서의 관측된 위상 공간 밀도 맞추기($\mathcal{L}_{\text{data}}$)
2. $(L, t)$ 영역 어디서나 방사상 확산 PDE 만족($\mathcal{L}_{\text{physics}}$)
3. 경계 조건 준수($\mathcal{L}_{\text{BC}}$)

물리 손실은 자동 미분을 사용하여 PDE 잔차를 평가함으로써 계산된다:

$$\mathcal{L}_{\text{physics}} = \left\| \frac{\partial f_\theta}{\partial t} - L^2 \frac{\partial}{\partial L}\left(\frac{D_{LL}}{L^2}\frac{\partial f_\theta}{\partial L}\right) + \frac{f_\theta}{\tau} \right\|^2$$

**PINN의 장점:**
- 보존 법칙 및 물리적 제약 준수
- 순수 데이터 기반 모델보다 훈련 데이터 적게 필요(물리가 정규화 제공)
- 물리적으로 그럴듯한 보간 및 외삽 생성
- 지배 방정식을 강제하면서 데이터로부터 알려지지 않은 파라미터(예: $D_{LL}$) 학습 가능

### 7.2 하이브리드 모델

하이브리드 모델은 물리 기반 구성 요소와 ML 구성 요소를 결합한다:

**잔차 학습(Residual learning):** 물리 모델을 실행한 후, ML 모델이 잔차(물리 모델과 관측 사이의 차이)를 예측하도록 훈련한다:

$$\hat{y} = y_{\text{physics}} + f_\theta(\mathbf{x})$$

ML 구성 요소는 기반 모델에서의 체계적 편향과 누락된 물리를 수정하는 방법을 학습한다. 이 접근법은:
- 물리적으로 합리적인 기준선에서 시작
- ML이 전체 문제보다 단순할 수 있는 "오차"만 학습하면 됨
- 우아하게 실패(ML 구성 요소가 엉뚱한 결과를 내도 물리 예측은 남음)

**신경 매개변수화(Neural parameterization):** 물리 모델의 불확실한 매개변수화를 학습된 신경망으로 대체한다. 예를 들어, 복사대 모델에서 경험적 파동 진폭 매개변수화 $B_w(\text{Kp}, L)$를 더 복잡한 의존성을 포착할 수 있는 신경망 $B_w = g_\theta(\text{Kp}, L, \text{AE}, \text{SYM-H}, \ldots)$로 대체한다.

### 7.3 전이 학습

**시뮬레이션→관측 전이:** 물리 시뮬레이션의 풍부한 합성 데이터로 훈련하고, 제한된 실제 관측으로 미세 조정한다. 이는 극단 사건에서 특히 가치 있다: 물리 모델에서 수천 건의 초강력 폭풍을 시뮬레이션할 수 있지만 관측된 것은 ~10건에 불과하다.

**교차 작업 전이:** Dst 예측으로 훈련된 모델은 Kp 예측으로 미세 조정할 수 있다. 두 예측 모두 유사한 태양풍 특징에 의존하기 때문이다. 사전 훈련된 태양 이미지 인코더(한 작업인 플레어 예측으로 훈련된)는 관련 작업(CME 탐지, 필라멘트 식별)으로 전이할 수 있다.

---

## 8. 도전 과제와 모범 사례

### 8.1 클래스 불균형

우주 기상 극단 사건은 드물다. 표준 접근법:

- **오버샘플링(SMOTE):** 소수 클래스 예제를 합성적으로 생성한다. 표 형식 데이터에는 효과적이지만 시계열에는 문제가 될 수 있다(생성된 샘플이 시간적 일관성을 위반할 수 있음).
- **가중 손실:** 손실 함수에서 소수 클래스 예제에 더 높은 가중치 부여: $w_{\text{event}} = N_{\text{total}} / (2 N_{\text{event}})$.
- **포컬 손실(Focal loss):** 쉽게 분류되는 예제의 가중치를 낮추고 어려운 것에 집중: $\mathcal{L}_{\text{focal}} = -\alpha (1-p)^\gamma \log(p)$.
- **임계값 조정:** 훈련 후 정확도 대신 TSS를 최대화하는 분류 임계값을 선택한다.

최선의 접근법은 특정 문제와 데이터셋 크기에 따라 다르다. 매우 드문 사건(10-20건 예제)의 경우, 정교한 재샘플링도 도움이 되지 않을 수 있다 — 모델이 단순히 패턴을 학습할 충분한 예제를 가지지 못한다.

### 8.2 비정상성

태양 주기는 데이터의 통계적 특성을 변화시킨다. 모범 사례:

- **태양 주기 인식 분할:** 우주 기상 시계열에 무작위 훈련/테스트 분할을 절대 사용하지 마라. 태양 주기 또는 연속 시간 기간으로 분할하라. 주기 23으로 훈련하고 주기 24로 테스트하면 운영 성능의 현실적인 추정치가 나온다.
- **슬라이딩 윈도우 재훈련:** 새로운 데이터가 확보됨에 따라 주기적으로 모델을 재훈련한다.
- **주기 단계 특징:** 태양 주기 단계(상승, 극대, 하강, 극소)를 입력 특징으로 포함한다.

### 8.3 해석 가능성

우주 기상 모델이 유용하려면 예보관이 신뢰해야 한다. 블랙박스 예측은 실행에 옮기기 어렵다. 해석 가능성 방법:

- **SHAP(SHapley Additive exPlanations):** 각 예측을 개별 특징의 기여로 귀속시킨다. 특정 Dst 예측을 구동하는 태양풍 파라미터를 드러낸다.
- **어텐션 맵:** 트랜스포머 모델에서 어텐션 가중치는 모델이 가장 중요하게 여기는 타임스텝을 보여준다.
- **그래디언트 기반 귀속:** 자기도의 CNN에 대해 $\partial \hat{y} / \partial x_{ij}$를 계산하여 어떤 픽셀이 플레어 예측을 이끄는지 식별한다.
- **특징 중요도:** 트리 기반 모델(랜덤 포레스트, XGBoost)의 내장 특징 중요도 순위.

### 8.4 벤치마크 데이터셋

우주 기상 ML 연구의 지속적인 문제는 표준화된 벤치마크의 부재다. 서로 다른 연구가 서로 다른 기간, 전처리, 평가 지표를 사용하여 공정한 비교가 불가능하다.

이를 해결하기 위한 새로운 시도들:
- **SWAN-SF(Space Weather Analytics for Solar Flares):** 정의된 훈련/테스트 분할이 있는 표준화된 플레어 예측 데이터셋
- **OMNI 기반 Dst 벤치마크:** Dst 예측을 위한 고정 훈련/테스트 기간
- 커뮤니티 챌린지(예: CCMC 플레어 스코어보드)

### 8.5 운영 배포

ML 모델을 운영에 배포하면 추가 요건이 생긴다:

- **지연 시간:** 모델은 수 시간이 아닌 수 초~수 분 내에 예측을 생성해야 한다.
- **입력 견고성:** 실시간 데이터에는 간격, 오류, 간헐적인 계측기 이상이 있다. 모델은 이를 우아하게 처리해야 한다(예: 보간, 플래그 전파).
- **우아한 성능 저하:** 핵심 입력이 불가능할 때(예: DSCOVR 데이터 간격), 모델은 충돌하거나 쓰레기를 생성하는 대신 축소 입력 버전으로 폴백해야 한다.
- **모니터링:** 드리프트를 위한 입력 분포 추적(데이터 이동 감지). 입력이 훈련 분포를 벗어나면 알림.
- **버전 관리:** 훈련 데이터, 하이퍼파라미터, 성능 지표의 엄격한 모델 버전 관리 및 문서화.

---

## 연습 문제

**문제 1.** 3시간 선행 Dst 예측을 위한 LSTM 모델을 설계한다. 훈련 데이터는 1995-2015년(OMNI 시간별 데이터)이다. 모델을 설계하라: 입력 특징, 윈도우 크기, 아키텍처, 손실 함수, 훈련/테스트 분할 전략을 지정하고 각 선택을 정당화하라. 그런 다음 강한 폭풍이 태양 주기당 약 30번 발생한다고 할 때, 훈련 데이터셋에 폭풍 사건(Dst < $-100$ nT)이 대략 몇 건 있는지 계산하라.

**문제 2.** SHARP 특징으로 훈련된 랜덤 포레스트 플레어 예측 모델이 10,000 활성 영역-일의 테스트 세트에서 다음 결과를 낸다: 적중 35건, 누락 15건, 오경보 50건, 정확한 기각 9,900건. POD, FAR, TSS, HSS, 정확도를 계산하라. 예보관이 정확도보다 TSS를 더 유용하게 여기는 이유를 설명하라. POD를 0.90으로 높이기 위해 분류 임계값을 낮추면 FAR이 어떻게 변할지 추정하고 그 트레이드오프를 논의하라.

**문제 3.** 복사대 방사상 확산 방정식에 대한 물리 정보 신경망(PINN)의 개념을 설명하라. 손실 함수의 세 구성 요소($\mathcal{L}_{\text{data}}$, $\mathcal{L}_{\text{physics}}$, $\mathcal{L}_{\text{BC}}$)를 수학적으로 쓰라. 위성 커버리지가 임의의 시간에 2-3개의 L-셸 값에서만 측정을 제공하는 희박한 공간 관측을 제공할 때 이 접근법의 장점을 논의하라.

**문제 4.** 500회의 항력 기반 모델 실행으로 구성된 CME 도착 시간 앙상블이 다음 분포를 생성한다: 평균 도착 시간 = 48시간, 표준 편차 = 8시간, 대략 가우스 형태. 위성 운영자는 실행하는 데 6시간이 걸리는 충돌 회피 기동을 수행할지 결정해야 한다. CME 도착 전에 기동이 완료될 90% 신뢰도를 보장하려면 언제 기동을 시작해야 하는가? 가정한 조건을 명시하라.

**문제 5.** ML 우주 기상 모델의 "태양 주기 일반화" 문제를 논의하라. 태양 주기 23(1996-2008)으로 훈련된 모델이 주기 23 보류 데이터에서 테스트할 때 탁월한 지표를 달성하지만 주기 24(2008-2019)에 적용하면 성능이 크게 저하된다. 이 저하가 발생하는 물리적 이유를 최소 세 가지 식별하라. 교차 주기 일반화를 개선하기 위한 두 가지 전략을 제안하라.

---

**이전**: [예보 모델](./14_Forecasting_Models.md) | **다음**: [프로젝트](./16_Projects.md)
