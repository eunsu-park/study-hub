# 프로젝트

## 학습 목표

- 여러 레슨에서 배운 태양 물리학 개념을 현실적인 계산 프로젝트에 적용한다
- 태양 복사 조도, 자기장, 플레어 물리학 지식을 통합하여 정량적 모델을 구축한다
- 실제 태양 데이터셋과 관측 아카이브를 활용한 과학적 데이터 분석을 실습한다
- PFSS 모델링을 통해 광구 자기장과 코로나/태양권 구조 사이의 관계에 대한 직관을 기른다
- 단순 경험적 피팅부터 물리 기반 외삽까지, 과학적 모델링 기술을 개발한다
- 머신러닝 문제로서 태양 플레어 예측의 도전 과제와 평가 지표를 이해한다

---

## 1. 프로젝트 1: 태양 복사 조도 모델

> **물리적 맥락**: 태양의 총 에너지 출력은 완전히 일정하지 않다 — 11년 자기 활동 주기에 걸쳐 ~0.1%만큼 변하고, 단기 시간 규모에서는 더 큰 폭으로 변한다. 이 프로젝트는 묻는다: *단 하나의 관측량(흑점 수)으로 태양의 밝기를 예측할 수 있을까?* 그 답은 두 자기 현상 사이의 아름다운 경쟁을 드러낸다 — 빛을 차단하는 어두운 흑점(Sunspot)과 밝기를 높이는 백반(Faculae) — 그리고 알짜 효과는 직관에 반한다: 백반에 의한 밝기 증가가 이기기 때문에, 더 많은 어두운 흑점이 있음에도 태양 극대기에 태양은 실제로 *더 밝아진다*.

### 1.1 배경 및 동기

총 태양 복사 조도(Total Solar Irradiance, TSI) — 1 AU에서의 태양 총 전자기 에너지 플럭스 — 는 약 1361 W/m$^2$로, 역사적으로 "태양 상수"라 불려왔다. 그러나 1978년부터 시작된 우주 기반 연속 측정 결과, TSI는 11년 태양 주기에 걸쳐 약 0.1%($\sim$1 W/m$^2$ 피크-투-피크)만큼 변한다는 사실이 밝혀졌다. 활동 영역이 통과할 때는 단기간에 더 큰 변동도 나타난다.

TSI 변동성을 이해하는 것은 두 가지 이유에서 중요하다:
1. **기후 과학**: 태양 입력의 작지만 지속적인 변화는 지구 기후에 영향을 줄 수 있다. 태양 주기의 ~1 W/m$^2$ 변동은 지구 평균 복사 강제력으로 환산하면 ~0.17 W/m$^2$(기하학적 효과와 반사율 고려)이며, 이는 수십 년 규모 온실 강제력 변화와 비슷한 크기이다.
2. **항성 물리학**: 태양은 항성 변동성 모델의 기준점 역할을 한다. 태양 복사 조도 변화의 원인을 이해하면 다른 태양형 별의 측광 변동을 해석하는 데 도움이 된다.

### 1.2 TSI 변동성의 물리

TSI 변동은 태양 표면의 두 종류 자기 구조가 경쟁적으로 작용한 결과이다.

**흑점(Sunspot)** (어두운 구조): 흑점 본영의 온도는 ~3500-4000 K로, 광구 온도 ~5800 K보다 훨씬 낮다. 복사 플럭스가 $T^4$에 비례하므로, 대비는 다음과 같다:

$$C_{\text{spot}} = 1 - \left(\frac{T_{\text{spot}}}{T_{\text{phot}}}\right)^4 \approx 1 - \left(\frac{4000}{5800}\right)^4 \approx 0.77$$

흑점은 동일 면적의 조용한 광구 대비 약 23%의 에너지만 복사한다. 따라서 흑점은 TSI를 감소시키며, 그 감소량은 흑점 전체 면적에 비례한다:

$$\Delta \text{TSI}_{\text{spot}} = -C_{\text{spot}} \cdot \frac{A_{\text{spot}}}{A_{\text{hemisphere}}} \cdot \text{TSI}_0$$

**백반(Faculae)** (밝은 구조): 백반은 자기장이 강화된 영역(채층에서는 플라지(plage)라 불림)으로, 특히 태양 가장자리 근처에서 밝게 보인다. 이 밝기 증가는 자기장이 플럭스 튜브 내부를 희박하게 만들어 관측자가 관이 벽을 통해 더 깊고 더 뜨거운 층을 볼 수 있게 되기 때문이다. 태양 주기 전체로 보면 백반의 밝기 증가가 흑점 어두움을 압도하는데, 이는 백반이 더 넓게 분포하고 흑점보다 더 오래 지속되기 때문이다.

TSI 알짜 변동은 이 두 효과의 합이다:

$$\frac{\Delta \text{TSI}}{\text{TSI}_0} = -\alpha \cdot f_{\text{spot}} + \beta \cdot f_{\text{fac}}$$

여기서:
- $f_{\text{spot}}$: 흑점이 반구 면적에서 차지하는 비율
- $f_{\text{fac}}$: 백반이 차지하는 비율
- $\alpha \approx 0.3$: 유효 흑점 대비(반음영은 본영보다 덜 어둡다는 점 반영)
- $\beta \approx 0.001$: 단위 면적당 백반 대비(개별적으로는 매우 작지만, 백반이 훨씬 넓은 면적을 차지함)

### 1.3 단순 경험적 모델

1차 모델로는 **흑점 수** $R$을 흑점 및 백반 면적의 대리 지표(proxy)로 사용할 수 있다:

$$f_{\text{spot}} \approx a_1 \cdot R$$
$$f_{\text{fac}} \approx a_2 \cdot R$$

여기서 $a_1$, $a_2$는 경험적 스케일링 인자이다. 백반 면적은 흑점 면적보다 크고(일반적으로 10-20배) 백반의 밝기 증가가 주기 시간 규모에서 지배적이므로, 알짜 효과는 다음과 같다:

$$\Delta \text{TSI} \approx c_0 + c_1 \cdot R$$

$c_1 > 0$ 이므로 — 흑점이 더 많은 태양 극대기에도 TSI는 증가한다. 전체 주기 평균에서 백반의 밝기 증가가 흑점 어두움을 이기기 때문이다.

그러나 자전 시간 규모(~27일)에서는 대형 흑점군이 가시 면반을 가로지를 때 TSI를 일시적으로 최대 4-5 W/m$^2$까지 줄일 수 있다.

### 1.4 프로젝트 구현

**1단계: 과거 흑점 수 데이터 획득.** 벨기에 왕립 천문대의 SILSO(Sunspot Index and Long-term Solar Observations) 데이터베이스에서 1700년부터 현재까지의 월별·일별 국제 흑점 수를 제공한다. 2015년 재교정 이후의 Version 2.0 시리즈를 사용해야 한다.

**2단계: 복사 조도 모델 구축.** TSI를 월별 흑점 수의 함수로 표현한다:

$$\text{TSI}(t) = S_0 + c_1 \cdot R(t)$$

여기서 $S_0 \approx 1360.5$ W/m$^2$(조용한 태양의 TSI)이고, $c_1$은 실측 TSI 데이터를 피팅하여 결정한다.

**3단계: 측정값으로 보정.** SORCE/TIM(2003-2020), TSIS-1/TIM(2018-현재), PMOD/WRC 복합 TSI 기록(1978-현재)과 비교한다. 최소제곱 회귀를 이용하여 최적 $c_1$을 결정한다.

**4단계: 모델 성능 평가.** 상관 계수와 RMS 잔차를 계산하고, 계통적 실패 사례를 분석한다(예: 월별 $R$은 자전 변동을 평활화하므로 모델이 개별 흑점군 통과를 포착하지 못함).

**5단계: 함의 분석.** 여러 태양 주기에 걸친 TSI를 도시한다. 마운더 극소기(1645-1715, $R \approx 0$)와 현대 태양 극대기 사이의 복사 강제력 변화를 추정한다. 마운더 극소기의 TSI 감소는 1-3 W/m$^2$로 추정되며, 전구 평균 강제력 변화는 ~0.2-0.5 W/m$^2$이다 — 현재 인위적 강제력 ~2.7 W/m$^2$에 비하면 작지만, 산업화 이전 기후 변동성에서는 무시할 수 없다.

### 1.5 물리적 토론 포인트

- 왜 주기 시간 규모에서 백반 밝기 증가가 흑점 어두움을 압도하는가?
- 흑점에 의해 차단된 "사라진" 에너지는 어떻게 되는가? 나중에 저장됐다가 재방출되는가, 아니면 주변 영역으로 재분배되는가?
- 흑점 면적과 흑점 수의 관계가 모델 정확도에 어떤 영향을 미치는가?
- 단일 대리 지표(흑점 수)를 TSI 모델에 사용할 때의 한계는 무엇인가?
- SATIRE(Spectral And Total Irradiance Reconstructions)와 NRLTSI2 모델은 이 단순 접근법과 어떻게 다른가?

---

## 2. 프로젝트 2: 포텐셜 자기장 소스 표면(PFSS) 외삽

> **물리적 맥락**: 코로나 자기장은 사실상 모든 태양 활동의 배후 조종자다 — 플레어에서 방출되는 에너지를 저장하고, 태양풍을 안내하며, CME의 형태를 만든다. 그러나 코로나 자기장을 직접 측정하기는 극히 어렵다. 이 프로젝트는 다음 질문에 도전한다: *측정 가능한 광구 자기장만으로 3차원 코로나 자기장을 재구성할 수 있을까?* PFSS 모델은 코로나에서 전류가 흐르지 않는다고 가정함으로써(무전류, 즉 포텐셜 자기장) "근사적으로 가능하다"고 답한다. 이 과감한 단순화에도 불구하고, 이 모델은 코로나 홀(Coronal holes), 헬멧 스트리머(Helmet streamers), 태양권을 지배하는 대규모 자기장 위상학을 성공적으로 재현한다.

### 2.1 배경 및 동기

광구 자기장은 SDO/HMI, GONG 등에 의해 비교적 잘 측정되지만, 코로나 자기장 — 코로나 가열, 태양풍 구조, 플레어 에너지 저장, CME 발생을 지배하는 — 은 대부분의 경우 직접 측정이 불가능하다(DKIST의 코로나 측정은 최근 예외이나 공간 범위가 제한적이다).

**포텐셜 자기장 소스 표면(Potential Field Source Surface, PFSS)** 모델은 광구 자기장을 코로나로 외삽하는 가장 단순하고 가장 널리 쓰이는 방법이다. 단순하지만(코로나를 무전류 상태로 가정), 대규모 코로나 구조를 놀랍도록 잘 재현하며, 태양풍 및 우주 기상 모델의 표준적인 출발점이다.

### 2.2 수학적 정식화

PFSS 모델은 광구($r = R_\odot$)와 "소스 표면"($r = R_{ss}$, 보통 2.5 $R_\odot$) 사이의 구면 껍질에서 라플라스 방정식을 푼다:

$$\nabla^2 \Phi = 0$$

여기서 $\mathbf{B} = -\nabla\Phi$ (무전류 조건, $\nabla \times \mathbf{B} = 0$).

**경계 조건:**
- **내부 경계** ($r = R_\odot$): 관측된 광구 자기도로부터 $B_r(R_\odot, \theta, \phi)$ 지정
- **외부 경계** ($r = R_{ss}$): $B_\theta = B_\phi = 0$ (순수 방사형 자기장), 태양풍이 자기 역선을 열린 상태로 늘이는 효과를 모사

$R_{ss}$에서의 방사형 자기장 조건이 핵심 단순화이다. 이는 특정 높이 이상에서는 태양풍의 동압이 자기 장력을 극복하여 모든 자기 역선이 열리고 방사형이 된다는 물리적 현실을 반영한다. $R_{ss} = 2.5 R_\odot$ 선택은 경험적인 것으로, 충분한 플럭스를 열면서 저 코로나에서 관측되는 닫힌 자기장 구조를 보존하는 균형점이다.

### 2.3 구면 조화 함수 해

구면 좌표에서 라플라스 방정식의 해는 구면 조화 함수의 합으로 표현된다:

$$\Phi(r, \theta, \phi) = R_\odot \sum_{l=1}^{l_{\max}} \sum_{m=0}^{l} \left[ a_{lm} \left(\frac{r}{R_\odot}\right)^l + b_{lm} \left(\frac{R_\odot}{r}\right)^{l+1} \right] Y_l^m(\theta, \phi)$$

여기서 $Y_l^m(\theta, \phi) = P_l^m(\cos\theta)(c_{lm}\cos m\phi + d_{lm}\sin m\phi)$는 실수 구면 조화 함수이고, $P_l^m$은 연관 르장드르 다항식이다.

계수 $a_{lm}$, $b_{lm}$은 두 경계 조건을 적용하여 결정된다:

$r = R_\odot$에서: 방사형 자기장 성분으로부터:

$$B_r(R_\odot, \theta, \phi) = -\frac{\partial \Phi}{\partial r}\bigg|_{r=R_\odot} = -\sum_{l,m} \left[ l \cdot a_{lm} - (l+1) \cdot b_{lm} \right] Y_l^m$$

$r = R_{ss}$에서: $B_\theta = B_\phi = 0$ 조건은 $\Phi(R_{ss}) = \text{const}$를 의미하며, 이로부터:

$$a_{lm} \left(\frac{R_{ss}}{R_\odot}\right)^l + b_{lm} \left(\frac{R_\odot}{R_{ss}}\right)^{l+1} = 0$$

이 두 조건으로부터 관측된 $B_r(R_\odot, \theta, \phi)$에 의해 $a_{lm}$, $b_{lm}$이 유일하게 결정된다.

### 2.4 프로젝트 구현

**1단계: 합성 자기도 생성.** 처음 구현할 때는 실제(잡음이 많고 복잡한) 데이터 대신, 위도-경도 격자 위에 합성 $B_r(R_\odot, \theta, \phi)$를 구성한다:

- **쌍극자 성분**: $B_r \propto \cos\theta$ (태양 극소기의 전지구 태양 쌍극자를 모사)
- **사중극자 성분**: $B_r \propto (3\cos^2\theta - 1)/2$ (다음 차수 항을 표현)
- **선택적**: 국소 양극성 활동 영역 추가 (반대 극성을 가진 두 가우시안 점 쌍)

**2단계: 구면 조화 계수 계산.** 합성 자기도를 $l_{\max}$까지(예: $l_{\max} = 15$로 시작) 구면 조화 함수로 분해한다. 이는 구 위에서의 수치 적분을 포함한다:

$$g_{lm} = \frac{2l+1}{4\pi} \frac{(l-m)!}{(l+m)!} \int B_r(R_\odot, \theta, \phi) P_l^m(\cos\theta) \cos(m\phi) \sin\theta \, d\theta \, d\phi$$

$h_{lm}$은 $\sin(m\phi)$를 사용하여 유사하게 계산한다.

**3단계: 3D 자기장 평가.** 결정된 $a_{lm}$, $b_{lm}$ 계수와 조화 전개로부터, 껍질 $[R_\odot, R_{ss}]$ 안의 임의 점 $(r, \theta, \phi)$에서 $B_r$, $B_\theta$, $B_\phi$를 계산한다.

**4단계: 자기 역선 추적.** 광구의 발판(footpoint)에서 출발하여 자기 역선 방정식을 적분한다:

$$\frac{dr}{B_r} = \frac{r \, d\theta}{B_\theta} = \frac{r \sin\theta \, d\phi}{B_\phi}$$

4차 룽게-쿠타(RK4) 방법을 사용한다. 각 단계에서 현재 위치의 자기장을 평가하고, 자기장 방향을 따라 작은 스텝만큼 위치를 이동시킨다.

**5단계: 자기 역선 분류.**
- **닫힌 역선**: $R_\odot$ 위의 한 극성에서 시작하여 $R_{ss}$에 도달하지 않고 $R_\odot$ 위의 반대 극성으로 돌아오는 역선
- **열린 역선**: $R_\odot$에서 $R_{ss}$까지 뻗어 태양권으로 "탈출"하는 역선

**6단계: 주요 구조 식별.**
- **코로나 홀(Coronal holes)**: 열린 자기장 영역(방사형 외향 또는 내향 극성). 고속 태양풍의 발원지이다.
- **스트리머 벨트(Streamer belt)**: 반대 극성의 열린 자기장 영역 사이의 경계로, 닫힌 루프가 밀도 높은 플라즈마를 가둔다.
- **태양권 전류 시트(Heliospheric current sheet, HCS)**: $R_{ss}$에서 $B_r$이 부호가 바뀌는 면으로, 태양권 전체로 뻗어 있는 휘어진 전류 시트에 해당한다.

### 2.5 물리적 토론 포인트

- $R_{ss}$를 변경하면 열린 플럭스 양에 어떤 영향을 미치는가? 태양풍 모델링에 어떤 결과를 가져오는가?
- 대규모 코로나에서 무전류 가정이 왜 합리적인가? 언제 실패하는가? (답: 강한 전단과 자유 에너지를 가진 활동 영역에서)
- PFSS 자기 역선 위상학을 SDO/AIA의 193 Å 영상과 비교해보자. 닫힌 루프와 코로나 홀 경계가 정성적으로 일치하는가?
- 태양권 전류 시트의 극성은 무엇이며, 행성간 자기장 섹터 구조와 어떤 관련이 있는가?
- 비포텐셜 모델(예: NLFFF — 비선형 힘-자유 자기장(Non-Linear Force-Free Field))로 어떻게 확장할 수 있는가?

---

## 3. 프로젝트 3: 활동 영역 매개변수를 이용한 플레어 예측

> **물리적 맥락**: 태양 폭발이 일어나기 전에 예측할 수 있을까? 플레어는 꼬이고 전단된 코로나 자기장에 저장된 에너지 $10^{29}$–$10^{32}$ erg를 수 분 만에 방출한다. 이 프로젝트는 광구 자기장의 측정 가능한 특성(총 플럭스, 극성 반전선(PIL) 복잡도, 자기 전단)이 플레어 예측에 충분한 정보를 담고 있는지 탐구한다. 결과는 겸허함을 준다: 최고의 모델조차 중간 수준의 기술만 달성한다. 이는 플레어 발화가 임계 임계값을 포함함을 시사한다 — 지진처럼, 시스템은 파괴 직전까지 응력을 받지만 정확한 파열 순간은 본질적으로 예측 불가능할 수 있다. 이는 태양 물리학을 복잡계에서의 예측 가능성이라는 더 넓은 질문과 연결시킨다.

### 3.1 배경 및 동기

태양 플레어 예측은 우주 기상 예보의 "대과제" 중 하나이다. 목표는 특정 활동 영역이 지정된 시간 창(보통 24시간) 내에 큰 플레어(M급 또는 X급, 연 X선 피크 플럭스 $\geq 10^{-5}$ W/m$^2$)를 일으킬지 예측하는 것이다.

이는 근본적으로 **이진 분류(binary classification)** 문제이다: 활동 영역의 현재 자기장 상태를 기술하는 특성(feature) 집합이 주어지면 "플레어 발생" 또는 "미발생"을 예측한다. 문제는 극단적인 클래스 불균형에 있다 — 플레어를 일으키는 활동 영역은 드물어서(전체 활동 영역-일수의 약 1-5%만이 M급 이상 플레어를 발생시킴), 항상 "미발생"을 예측하는 순진한 분류기가 95% 이상의 정확도를 달성하지만 실질적으로는 쓸모없다.

### 3.2 활동 영역 자기장 매개변수

핵심 통찰은, 플레어는 코로나 자기장에 저장된 자유 자기 에너지에 의해 구동되며, 이 에너지는 측정 가능한 광구 자기장 특성과 관련된다는 것이다. SDO/HMI 벡터 자기도에서 계산 가능한 다음 매개변수들이 예측 가치가 있음이 입증되었다:

**총 부호 없는 자기 플럭스:**

$$\Phi_{\text{total}} = \int |B_r| \, dA$$

큰 활동 영역(더 많은 플럭스)은 더 많은 에너지를 갖고 있어 더 큰 플레어를 일으키는 경향이 있다. 그러나 $\Phi_{\text{total}}$ 만으로는 예측력이 낮은데, 크고 잘 정렬된 영역도 플레어를 일으키지 않는 경우가 많기 때문이다.

**극성 반전선(PIL) 근처의 플럭스(R값):**

$$R = \int_{\text{PIL}} |B_{\text{LOS}}| \, dA$$

극성 반전선(Polarity Inversion Line, PIL)은 $B_r$이 부호가 바뀌는 곳이다. PIL 근처에 집중된 플럭스는 반대 극성이 촘촘히 묶여 있음을 나타내며, 이는 재결합이 일어나기 쉬운 배치이다. Schrijver(2007)가 도입한 R값은 PIL 주변 좁은 띠(예: 15 Mm) 안의 강자기장 픽셀로 가중된 총 부호 없는 플럭스로, 대형 플레어의 가장 뛰어난 단일 예측 지표 중 하나이다.

**PIL을 따른 총 자기장 기울기:**

$$G_{\text{PIL}} = \sum_{\text{PIL}} |\nabla B_{\text{LOS}}|$$

PIL 근처의 강한 기울기는 반대 극성 사이의 급격한 전환 — 자유 에너지를 저장하는 고도로 전단된 배치 — 을 나타낸다.

**자기 전단각(Magnetic shear angle):**

$$\Delta\psi = \arccos\left(\frac{\mathbf{B}_{\text{obs}} \cdot \mathbf{B}_{\text{pot}}}{|\mathbf{B}_{\text{obs}}||\mathbf{B}_{\text{pot}}|}\right)$$

관측된 (비포텐셜) 횡방향 자기장과 포텐셜(무전류) 횡방향 자기장 사이의 각도. 큰 전단은 강한 전류와 저장된 자유 에너지를 나타낸다. PIL을 따라 평균 전단이 40°를 초과하는 영역은 플레어 발생 가능성이 현저히 높다.

**총 광구 자유 에너지 대리 지표:**

$$\rho_{\text{free}} = \sum (B_{\text{obs}} - B_{\text{pot}})^2$$

포텐셜 자기장 상태보다 초과된 자기 에너지 밀도에 비례하며, 방출 가능한 에너지를 직접 추정한다.

**추가 특성**: 유효 연결 자기장, 총 부호 없는 전류 헬리시티, 강자기장 PIL 면적, 이징 에너지(통계역학 유비에서), 그리고 시간 미분 특성(플럭스 출현율, 전단 진화).

### 3.3 분류 방법

**로지스틱 회귀(Logistic regression)**: 단순한 기준선. 플레어 발생 로그 오즈비를 특성의 선형 결합으로 모델링한다:

$$\log\frac{P(\text{flare})}{1 - P(\text{flare})} = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \ldots$$

로지스틱 회귀는 해석하기 쉽고(계수가 어떤 특성이 가장 중요한지 알려줌) 보정된 확률을 제공한다. M급 예측의 TSS는 보통 ~0.4-0.6이다.

**랜덤 포레스트(Random forest)**: 데이터와 특성의 랜덤 부분 집합으로 각각 훈련된 의사결정 나무의 앙상블. 비선형 관계, 특성 상호작용을 처리하고 과적합에 강건하다. 보통 TSS ~0.5-0.7을 달성하고 특성 중요도 순위를 제공한다.

**더 발전된 방법**: 서포트 벡터 머신, 그래디언트 부스팅(XGBoost, LightGBM), 딥러닝(자기도 영상에 대한 CNN, 특성 시계열에 대한 LSTM)도 연구되어 왔다. 최고의 모델은 TSS ~0.6-0.8을 달성하지만, 어떤 모델도 TSS ~0.8을 일관되게 초과하지 못하며, 이는 플레어 방아쇠(trigger) 메커니즘의 확률적 특성과 관련된 근본적 한계를 시사한다.

### 3.4 평가 지표

극심한 불균형 문제에는 표준 분류 지표가 부적절하다. 핵심 지표는 **진기술 통계량(True Skill Statistic, TSS)**으로, Hanssen-Kuipers 판별자라고도 한다:

$$\text{TSS} = \frac{TP}{TP + FN} - \frac{FP}{FP + TN} = \text{TPR} - \text{FPR}$$

여기서 TP = 진양성, FN = 거짓음성, FP = 거짓양성, TN = 진음성, TPR = 진양성률(민감도/재현율), FPR = 거짓양성률.

TSS는 $-1$에서 $+1$의 범위를 가진다:
- $\text{TSS} = 1$: 완벽한 예측
- $\text{TSS} = 0$: 기술 없음(무작위 추측 또는 상수 예측과 동등)
- $\text{TSS} < 0$: 무작위보다 나쁨

TSS의 결정적 특성은 **기저율(base-rate) 독립적**이라는 점 — 플레어 발생일과 미발생일의 상대적 빈도에 관계없이 값이 변하지 않는다. 이는 정확도 지표가 오해를 낳는 불균형 플레어 예측 문제에 TSS를 적합하게 만든다.

기타 유용한 지표:
- **브라이어 기술 점수(Brier Skill Score, BSS)**: 확률적 예보 품질을 측정
- **신뢰도 다이어그램(Reliability diagram)**: 예측 확률이 잘 보정되었는지 확인
- **ROC 곡선과 AUC**: 수신기 동작 특성(Receiver Operating Characteristic)으로, 곡선 아래 면적(AUC)이 전체 판별 능력을 요약

### 3.5 프로젝트 구현

**1단계: 데이터 획득.** SDO/HMI의 SHARP(Space-weather HMI Active Region Patches) 데이터 산물은 위에 나열된 많은 특성을 포함한 활동 영역 매개변수를 미리 계산하여 제공한다. SHARP 데이터 카탈로그는 JSOC를 통해 접근 가능하다. 이 프로젝트를 위해 SHARP 키워드와 해당 GOES 플레어 연관 정보를 포함한 부분 집합(예: 1-2년치 데이터)을 다운로드한다.

**2단계: 데이터셋 준비.** 각 활동 영역의 각 시간 단계(예: 12시간마다):
- 특성: SHARP 매개변수($\Phi_{\text{total}}$, R값, 평균 전단, 총 전류 등)
- 레이블: 이 활동 영역이 다음 24시간 내에 M급 이상 플레어를 일으켰는가? (이진: 1/0)

**3단계: 클래스 불균형 처리.** 방법:
- 소수 클래스 과표본 추출(SMOTE)
- 다수 클래스 과소 표본 추출
- 클래스 가중 손실 함수
- 검증 집합에서의 임계값 최적화

**4단계: 훈련 및 평가.** 시간적 교차 검증을 사용한다(이전 데이터로 훈련, 이후 데이터로 테스트 — 데이터 누출을 피하기 위해 절대 반대로 하지 말 것). TSS, AUC를 계산하고 신뢰도 다이어그램을 생성한다.

**5단계: 특성 중요도 분석.** 어떤 특성이 예측에 가장 많이 기여하는가? R값이 지배적인가? 플럭스 출현의 시간 미분이 유효한가? 출판된 결과와 비교한다.

**6단계: 기후학적 기준선과 비교.** 가장 단순한 "모델"은 기후학적 플레어 발생률이다: 각 HALE 등급의 역사적 플레어 발생률로 플레어 확률을 예측한다. 이 방법의 TSS는 얼마인가? 구축한 모델이 이 기준선을 유의미하게 초과해야 한다.

### 3.6 물리적 토론 포인트

- 왜 플레어 예측은 근본적으로 한계가 있는가? (힌트: 방아쇠 메커니즘이 확률적일 수 있다 — 임계 응력 상태의 활동 영역에서 작은 요동이 플레어를 일으키거나 막을 수 있다.)
- 예측을 개선하기 위해 어떤 추가 정보가 도움이 될 수 있는가? (코로나 자기장? 광구 흐름 패턴? 데이터 기반 MHD 시뮬레이션?)
- 예측 시간 범위가 정확도에 어떤 영향을 미치는가? (짧은 범위가 더 정확하지만 대응 준비에는 덜 유용하다.)
- 이전 플레어 발생 이력의 역할은 무엇인가? (이미 플레어가 발생한 활동 영역은 다시 발생하는 경향이 있다 — "플레어 생산성"이 유용한 특성이다.)
- 단순 발생 여부가 아닌 플레어 규모(C/M/X)를 예측하도록 어떻게 확장할 수 있는가?

---

## 4. 프로젝트 확장

### 4.1 프로젝트 1 확장 (태양 복사 조도)

- **흑점 및 백반 성분 분리**: $R$을 두 성분 모두의 대리 지표로 사용하는 대신, 어두움 성분에는 측광 흑점 지수(Photometric Sunspot Index, PSI; 흑점 면적과 위치에서 유도)를, 백반 밝기 증가에는 Mg II 지수나 F10.7 전파 플럭스를 사용한다. 이 2성분 모델은 자전 및 주기 변동을 더 정확하게 포착한다.
- **분광 복사 조도**: TSI에서 분광 태양 복사 조도(Spectral Solar Irradiance, SSI)로 확장한다. 자외선 복사 조도는 태양 주기에 걸쳐 5-10% 변동하며(TSI 변동 0.1%보다 훨씬 큼), 오존 화학에 중요한 영향을 미친다. NRLTSI2/NRLSSI2 모델 프레임워크를 사용한다.
- **장기 트렌드**: 11년 주기를 넘어 TSI에 세속적인 트렌드가 있는지 조사한다. 글라이스베르크 주기(~80-90년)와 가능한 그랜드 극소기는 장기 기후 모델링에 관련된다.
- **항성 측광과의 비교**: TSI 모델 개념을 Kepler/TESS로 관측된 태양형 별의 측광 변동성을 이해하는 데 적용한다.

### 4.2 프로젝트 2 확장 (PFSS)

- **캐링턴 자전에 걸쳐 애니메이션 제작**: 한 태양 자전(~27일)에 걸쳐 일련의 동기 자기도에 대해 PFSS 해를 계산한다. 자기 역선 진화를 애니메이션으로 만들어 코로나 위상학의 변화를 시각화한다.
- **SDO/AIA와 비교**: 계산된 열린/닫힌 자기장 경계를 SDO/AIA 193 Å 영상에 겹쳐 표시한다. 코로나 홀은 열린 자기장 영역에, 밝은 스트리머 벨트는 열린 자기장 도메인의 경계에 대응해야 한다.
- **Wang-Sheeley-Arge(WSA) 모델**: PFSS 해를 이용하여 각 열린 플럭스 튜브의 팽창 인자 $f_s$를 계산한다:

$$f_s = \left(\frac{R_\odot}{R_{ss}}\right)^2 \frac{B(R_\odot)}{B(R_{ss})}$$

WSA 모델은 $f_s$와 가장 가까운 코로나 홀 경계까지의 각거리를 1 AU에서의 태양풍 속도와 연결한다. 이 경험적 관계를 구현하고 관측된 태양풍 속도(OMNI 데이터베이스 또는 DSCOVR)와 비교한다.
- **비포텐셜 확장**: 소스 표면에 수평 전류 시트를 포함하는 전류 시트 소스 표면(Current Sheet Source Surface, CSSS) 모델을 구현한다. 이는 보다 현실적인 태양권 자기장 위상학을 제공한다.

### 4.3 프로젝트 3 확장 (플레어 예측)

- **다중 클래스 예측**: 이진(M+/비-M+)에서 다중 클래스(C/M/X 또는 조용/C/M/X)로 확장한다. 순서 회귀(ordinal regression) 또는 분류기의 다중 클래스 확장을 사용한다.
- **시계열 특성**: 순간 매개변수 대신, 6, 12, 24, 48시간 창에 걸친 SHARP 매개변수의 이동 통계(평균, 추세, 변동성)를 계산한다. 자기 복잡도의 급격한 변화가 플레어의 전조가 될 수 있다.
- **자기도 딥러닝**: 미리 계산된 스칼라 특성 대신 HMI 자기도 영상 패치에 직접 CNN을 훈련한다. 이를 통해 수동 특성 공학 없이 공간 패턴(PIL 형태, 전단 분포)을 학습할 수 있다.
- **시간적 진화를 위한 LSTM**: SHARP 특성의 시간 시퀀스에 장단기 메모리(LSTM) 순환 신경망을 적용하여, 플레어에 앞서 나타나는 플럭스 출현과 전단 진화의 시간적 패턴을 학습한다.
- **앙상블 접근**: 로지스틱 회귀, 랜덤 포레스트, CNN 예측을 스태킹 또는 블렌딩을 이용하여 결합한다(Machine_Learning 토픽의 스태킹/블렌딩 레슨 참조).

---

## 5. 참고 문헌 및 데이터 출처

### 5.1 데이터 아카이브

- **SILSO(Sunspot Index and Long-term Solar Observations)**: 1700년부터 현재까지의 월별·일별 국제 흑점 수. https://www.sidc.be/silso/
- **JSOC(Joint Science Operations Center)**: SDO/HMI 자기도, 도플러 속도도, AIA 영상, SHARP 활동 영역 데이터 산물. http://jsoc.stanford.edu/
- **GOES X선 플럭스**: NOAA/NCEI 우주 기상 데이터, 플레어 예측 모델 훈련에 사용되는 공식 GOES 플레어 목록 포함. https://www.ncei.noaa.gov/
- **OMNI 데이터베이스**: 여러 L1 모니터(ACE, Wind, DSCOVR)의 데이터를 통합한 1 AU에서의 태양풍 매개변수. https://omniweb.gsfc.nasa.gov/
- **SOHO/LASCO CME 카탈로그**: 1996년 이후 감지된 40,000개 이상의 CME 종합 카탈로그. https://cdaw.gsfc.nasa.gov/CME_list/
- **Parker Solar Probe 및 Solar Orbiter 데이터**: 인-시투 데이터는 SPDF/CDAWeb, 보정된 과학 산물은 각 기기팀 웹사이트. https://cdaweb.gsfc.nasa.gov/

### 5.2 소프트웨어 도구

- **SunPy**: 태양 물리학 데이터 분석을 위한 오픈소스 Python 라이브러리. 데이터 검색(Fido), 좌표 변환, 시각화 포함. https://sunpy.org/
- **pfsspy**: PFSS 외삽을 위한 Python 패키지. GONG 및 HMI 동기 자기도를 직접 읽는다. 문서가 잘 정비되어 있고 활발히 유지 보수된다.
- **aiapy**: SDO/AIA 데이터 분석 도구(응답 함수, PSF 역합성, DEM).
- **scikit-learn**: 머신러닝 분류기(로지스틱 회귀, 랜덤 포레스트, SVM, 지표) 사용.
- **Astropy**: 일반 천문학 Python 유틸리티(좌표계, 단위, FITS 파일 처리).
- **Helioviewer / JHelioviewer**: 다임무 태양 영상을 오버레이 및 타임랩스 기능과 함께 탐색하기 위한 브라우저 기반 및 Java 기반 도구.

### 5.3 주요 참고 문헌

- Schrijver, C. J. (2007): "A Characteristic Magnetic Field Pattern Associated with All Major Solar Flares and Its Use in Flare Forecasting." R값을 플레어 예측 지표로 도입한 논문.
- Altschuler, M. D. & Newkirk, G. (1969): "Magnetic Fields and the Structure of the Solar Corona." 최초의 PFSS 모델 논문.
- Lean, J. (2000): "Evolution of the Sun's Spectral Irradiance Since the Maunder Minimum." 장기 복사 조도 재구성의 기초 연구.
- Bobra, M. G. & Couvidat, S. (2015): "Solar Flare Prediction Using SDO/HMI Vector Magnetic Field Data with a Machine-Learning Algorithm." SHARP 매개변수에 머신러닝을 적용한 연구.
- Riley, P. et al. (2019): "On the Relationship Between Sunspot Number and Solar Spectral Irradiance." 흑점-복사 조도 연결의 현대적 분석.
- Yeates, A. R. et al. (2018): "Global Non-potential Magnetic Models of the Solar Corona." PFSS를 넘어서는 코로나 자기장 모델링 리뷰.

### 5.4 다른 토픽과의 연계

이 프로젝트들은 학습 자료 내 여러 다른 토픽과 자연스럽게 연결된다:

- **Machine_Learning**: 분류 알고리즘, 평가 지표, 특성 공학, 클래스 불균형 처리, 앙상블 방법(스태킹/블렌딩)
- **Data_Science**: 탐색적 데이터 분석, 시계열 분석, 통계적 가설 검정
- **Deep_Learning**: 영상 분류를 위한 CNN 아키텍처(자기도 기반 플레어 예측), 시계열을 위한 LSTM
- **Python**: 데이터 처리(NumPy, Pandas), 과학 계산(SciPy)
- **Numerical_Simulation**: ODE 적분(자기 역선 추적을 위한 RK4), 구면 조화 함수
- **Mathematical_Methods**: 구면 조화 함수, 르장드르 다항식, 구면 좌표에서의 라플라스 방정식

---

## 연습 문제

**문제 1**: TSI 모델 $\text{TSI}(t) = 1360.5 + 0.008 \times R(t)$ W/m$^2$ (여기서 $R$은 월별 흑점 수)를 사용하여, (a) 태양 극소기($R = 5$), (b) 보통 태양 극대기($R = 120$), (c) 강한 태양 극대기($R = 200$)의 TSI를 계산하라. 피크-투-피크 변동은 얼마인가? 이를 $S_0$의 백분율로 표현하라. 이에 해당하는 전구 평균 복사 강제력 변화는 얼마인가? (TSI 변화를 전구 평균 강제력으로 변환하는 인수 0.175 사용)

**문제 2**: PFSS 모델에서 소스 표면은 보통 $R_{ss} = 2.5 R_\odot$으로 설정된다. 순수 쌍극자 자기장의 경우, 소스 표면에서의 방사형 자기장은 $B_r(R_{ss}) = B_0 (R_\odot/R_{ss})^3 \cos\theta$ (구면 껍질에서의 포텐셜 자기장)이다. 총 부호 없는 열린 자기 플럭스 $\Phi_{\text{open}} = \int |B_r(R_{ss})| \, dA_{ss}$를 $B_0$와 $R_\odot$으로 표현하라. $B_0 = 5$ G(전형적인 조용한 태양의 극 자기장)일 때 $\Phi_{\text{open}}$을 Mx 단위로 계산하라. 관측값 $\sim 3 \times 10^{22}$ Mx와 비교하라.

**문제 3**: 어떤 활동 영역이 다음 SHARP 매개변수를 가진다: 총 부호 없는 플럭스 $\Phi = 5 \times 10^{22}$ Mx, R값 $= 3 \times 10^{21}$ Mx, 평균 전단각 $= 45°$. 로지스틱 회귀 모델이 $\log(P/(1-P)) = -5.0 + 2.0 \times \log_{10}(R/10^{20}) + 0.05 \times \bar{\psi}$를 제공한다. 24시간 내 M급 플레어의 예측 확률을 계산하라. 기후학적 발생률이 3%라면, 이 활동 영역은 위험도가 높은가?

**문제 4**: 1000개의 활동 영역-일수(플레어 발생 30개, 미발생 970개)로 이루어진 테스트 집합에서 TP = 20, FN = 10, FP = 100, TN = 870을 출력하는 플레어 예측 모델을 평가하고 있다. 정확도, TPR(재현율), FPR, 정밀도, F1 점수, TSS를 계산하라. 동일 테스트 집합에서 동료의 모델이 TP = 25, FN = 5, FP = 200, TN = 770을 제공한다. TSS로 두 모델을 비교하고, 어느 모델이 운용 측면에서 더 유용한지 논의하라.

---

**이전**: [현대 태양 탐사선](./15_Modern_Solar_Missions.md)
