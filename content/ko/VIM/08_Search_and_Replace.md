# 검색과 치환(Search and Replace)

**이전**: [비주얼 모드](./07_Visual_Mode.md) | **다음**: [레지스터, 마크, 매크로](./09_Registers_Marks_and_Macros.md)

---

## 학습 목표

이 레슨을 마치면 다음을 할 수 있습니다:

1. 앞으로(`/`) 및 뒤로(`?`) 검색하고, `n`/`N`으로 일치 항목 사이를 이동하기
2. `*`와 `#`으로 커서 아래 단어 검색하기
3. `:s`와 플래그(`g`, `c`, `i`)를 사용해 치환(Substitution) 수행하기
4. Vim의 패턴 매칭을 위한 기본 정규 표현식(Regular Expression) 작성하기
5. `:g` (전역) 명령으로 강력한 줄 기반 작업 수행하기

---

검색(Search)은 큰 파일을 탐색하는 방법이고, 치환(Substitution)은 일괄 변경을 수행하는 방법입니다. 이 둘은 함께 Vim의 가장 강력한 기능 중 하나를 이룹니다. 다른 편집기에서 별도의 "찾기 및 바꾸기" 대화상자가 필요한 많은 작업들이 Vim에서는 간단한 명령 하나로 해결됩니다.

## 목차

1. [기본 검색](#1-기본-검색)
2. [검색 옵션과 하이라이트](#2-검색-옵션과-하이라이트)
3. [커서 아래 단어](#3-커서-아래-단어)
4. [치환 기초](#4-치환-기초)
5. [치환 범위](#5-치환-범위)
6. [치환 플래그](#6-치환-플래그)
7. [Vim의 정규 표현식](#7-vim의-정규-표현식)
8. [전역 명령](#8-전역-명령)
9. [실용 예제](#9-실용-예제)
10. [요약](#10-요약)

---

## 1. 기본 검색

### 앞으로 검색(Forward Search)

```
/pattern     → "pattern"을 앞 방향으로 검색
n            → 다음 일치 항목으로 이동
N            → 이전 일치 항목으로 이동
```

### 뒤로 검색(Backward Search)

```
?pattern     → "pattern"을 뒤 방향으로 검색
n            → 다음 일치 항목으로 이동 (뒤 방향 기준)
N            → 이전 일치 항목으로 이동 (앞 방향 기준)
```

### 모션으로서의 검색(Search as a Motion)

검색은 연산자와 함께 모션(Motion)으로 동작합니다:

```
d/function   → 커서부터 "function"까지 삭제
y/end        → 커서부터 "end"까지 복사
c/TODO       → 커서부터 "TODO"까지 변경
```

### 검색 취소

검색 패턴 입력 중 `Esc`를 누르면 취소됩니다.

---

## 2. 검색 옵션과 하이라이트

### 일치 항목 하이라이트

```vim
:set hlsearch      " 모든 일치 항목 하이라이트
:set nohlsearch    " 하이라이트 영구 비활성화
:nohlsearch        " 현재 하이라이트만 지우기 (다음 검색 전까지)
:noh               " 단축 형식
```

### 점진적 검색(Incremental Search)

```vim
:set incsearch     " 입력하면서 일치 항목 표시 (라이브 미리보기)
```

`incsearch`가 켜져 있으면 각 문자를 입력할 때마다 Vim이 첫 번째 일치 항목으로 이동합니다. `Enter`를 눌러 확정하거나 `Esc`를 눌러 취소합니다.

### 대소문자 구분

```vim
:set ignorecase    " 대소문자 구분 없이 검색
:set smartcase     " 패턴에 대문자가 있으면 대소문자 구분
```

`ignorecase`와 `smartcase`를 함께 설정하면:
- `/hello`는 "Hello", "HELLO", "hello" 모두 일치
- `/Hello`는 "Hello"만 일치 (대문자가 있으면 대소문자 구분 강제)

### 검색별 대소문자 재정의

| 패턴 | 의미 |
|---------|---------|
| `/pattern\c` | 대소문자 구분 없이 강제 |
| `/pattern\C` | 대소문자 구분 강제 |

---

## 3. 커서 아래 단어

| 명령 | 동작 |
|---------|--------|
| `*` | 커서 아래 단어를 앞으로 검색 (완전한 단어 일치) |
| `#` | 커서 아래 단어를 뒤로 검색 |
| `g*` | 앞으로 검색 (부분 일치 — 단어 경계 없음) |
| `g#` | 뒤로 검색 (부분 일치) |

```python
def calculate_total(items):    ← 커서가 "calculate_total" 위에 있음
    return calculate_total_v2(items)

*   → 다음 "calculate_total"로 이동 (완전한 단어, calculate_total_v2는 일치하지 않음)
g*  → 부분 일치 포함 다음 출현 위치로 이동
```

이 기능은 변수나 함수 이름의 모든 출현을 찾을 때 매우 유용합니다.

---

## 4. 치환 기초

치환(Substitute) 명령은 패턴에 일치하는 텍스트를 교체합니다:

```
:[range]s/pattern/replacement/[flags]
```

### 간단한 예제

```vim
:s/old/new/        " 현재 줄에서 첫 번째 'old'를 'new'로 교체
:s/old/new/g       " 현재 줄에서 모든 'old'를 'new'로 교체
:%s/old/new/g      " 파일 전체에서 모든 'old'를 'new'로 교체
:%s/old/new/gc     " 모두 교체하되, 각각 확인 요청
```

### 대체 구분자(Alternative Delimiters)

패턴에 `/`가 포함된 경우 다른 구분자를 사용하세요:

```vim
:s#/usr/local#/opt#g        " 경로 교체 (# 구분자 사용)
:s|http://|https://|g       " URL 교체 (| 구분자 사용)
```

---

## 5. 치환 범위

범위(Range)는 영향을 줄 줄을 지정합니다:

| 범위 | 의미 |
|-------|---------|
| (없음) | 현재 줄만 |
| `%` | 파일 전체 |
| `1,10` | 1번째 줄부터 10번째 줄까지 |
| `.,$` | 현재 줄부터 파일 끝까지 |
| `.,+5` | 현재 줄과 다음 5줄 |
| `'<,'>` | 비주얼 선택 영역 (비주얼 모드에서 `:` 입력 시 자동 삽입) |
| `'a,'b` | 마크(Mark) `a`부터 마크 `b`까지 |
| `/start/,/end/` | "start"에 일치하는 줄부터 "end"에 일치하는 줄까지 |

### 예제

```vim
:10,20s/foo/bar/g       " 10-20번째 줄에서 교체
:.,$s/foo/bar/g         " 현재 줄부터 끝까지 교체
:'<,'>s/foo/bar/g       " 비주얼 선택 영역에서 교체
:/BEGIN/,/END/s/foo/bar/g   " BEGIN과 END 마커 사이에서 교체
```

---

## 6. 치환 플래그

| 플래그 | 의미 |
|------|---------|
| `g` | 전역(**G**lobal) — 각 줄에서 첫 번째뿐 아니라 모든 출현 교체 |
| `c` | 각 교체 확인(**C**onfirm) |
| `i` | 대소문자 구분 없이(**i**gnore case) |
| `I` | 대소문자 구분 |
| `n` | 일치 항목 수만 세기 (교체 안 함) |
| `e` | 일치 항목 없을 때 오류 억제 |

### 확인 모드(`c` 플래그)

`c` 플래그를 사용하면 각 일치 항목마다 Vim이 확인을 요청합니다:

```vim
:%s/old/new/gc
```

각 일치 항목에서 다음과 같이 표시됩니다:

```
replace with new (y/n/a/q/l/^E/^Y)?
```

| 응답 | 동작 |
|----------|--------|
| `y` | 이 항목 교체 |
| `n` | 이 항목 건너뛰기 |
| `a` | 나머지 모두 교체(**a**ll) |
| `q` | 치환 종료(**q**uit) |
| `l` | 이 항목 교체 후 종료 (마지막, **l**ast) |
| `Ctrl-e` | 위로 스크롤 |
| `Ctrl-y` | 아래로 스크롤 |

---

## 7. Vim의 정규 표현식

Vim은 자체적인 정규식(Regex) 방식을 사용하며, PCRE(Perl 호환)와 약간 다릅니다.

### 기본 메타문자(Metacharacters)

| 패턴 | 일치 대상 |
|---------|---------|
| `.` | 임의의 단일 문자 |
| `*` | 이전 항목의 0회 이상 |
| `\+` | 이전 항목의 1회 이상 |
| `\?` | 이전 항목의 0회 또는 1회 |
| `\|` | 선택(OR) |
| `^` | 줄의 시작 |
| `$` | 줄의 끝 |
| `\<` | 단어 경계(Word Boundary) 시작 |
| `\>` | 단어 경계 끝 |

### 문자 클래스(Character Classes)

| 패턴 | 일치 대상 |
|---------|---------|
| `[abc]` | a, b, c 중 하나 |
| `[a-z]` | 소문자 |
| `[0-9]` | 숫자 |
| `[^abc]` | a, b, c가 아닌 것 |
| `\d` | 숫자 (`[0-9]`와 동일) |
| `\w` | 단어 문자(`[a-zA-Z0-9_]`) |
| `\s` | 공백 문자 |

### 캡처 그룹(Capture Groups)

```vim
:%s/\(\w\+\), \(\w\+\)/\2 \1/g
```

이 명령은 "성, 이름" 형식을 "이름 성" 형식으로 바꿉니다:
- `\(`와 `\)`로 캡처 그룹을 만듦
- `\1`, `\2`는 교체 문자열에서 캡처된 그룹을 참조

### Very Magic 모드

Vim의 기본 정규식에서는 많은 메타문자를 이스케이프해야 합니다. `\v`를 사용하면 "very magic" 모드가 활성화되어 대부분의 문자가 특수한 의미를 가지게 됩니다 (PCRE와 유사):

```vim
" 기본 (+ | ( ) 이스케이프 필요)
:%s/\(foo\|bar\)\+/baz/g

" Very magic (이스케이프 불필요)
:%s/\v(foo|bar)+/baz/g
```

---

## 8. 전역 명령

`:g` 명령은 패턴에 일치하는 모든 줄에서 명령을 실행합니다:

```
:[range]g/pattern/command
```

### 기본 사용법

```vim
:g/TODO/d              " "TODO"가 포함된 모든 줄 삭제
:g/^$/d                " 모든 빈 줄 삭제
:g/DEBUG/normal dd     " "DEBUG"가 포함된 줄 삭제
:g/pattern/p           " 일치하는 모든 줄 출력(표시)
```

### 역 전역(Inverse Global, `:v`)

`:v`는 반대 명령으로, 일치하지 않는 줄에 동작합니다:

```vim
:v/important/d         " "important"가 없는 모든 줄 삭제
:v/\S/d                " 공백이 아닌 문자가 없는 줄(빈 줄) 삭제
```

### 고급 전역 명령 예제

```vim
" 모든 TODO 주석을 파일 끝으로 이동
:g/TODO/m $

" 모든 함수 정의를 레지스터 a에 복사
:g/^def /yank A

" 비어 있지 않은 모든 줄에 번호 붙이기
:g/\S/s/^/\=line('.').' '/

" 패턴에 일치하는 줄 정렬
:g/^import/sort
```

### 전역 + 치환

```vim
" "config"가 포함된 줄에서만 치환
:g/config/s/old/new/g

" 주석 줄에서만 후행 공백 삭제
:g/^#/s/\s\+$//
```

---

## 9. 실용 예제

### 변수 이름 바꾸기

```vim
" 파일 전체에서 'oldName'을 'newName'으로 변경
:%s/oldName/newName/g

" 완전한 단어만 변경 ('oldNameExtra'는 변경 안 됨)
:%s/\<oldName\>/newName/g

" 확인하면서 변경
:%s/\<oldName\>/newName/gc
```

### 후행 공백 제거

```vim
:%s/\s\+$//g
```

### 탭을 공백으로 변환

```vim
:%s/\t/    /g          " 탭을 공백 4개로 교체
```

### 줄 끝에 세미콜론 추가

```vim
:%s/$/;/               " 모든 줄 끝에 세미콜론 추가
```

### 코드 주석 처리/해제

```vim
" 10-20번째 줄 주석 처리 (앞에 # 추가)
:10,20s/^/# /

" 주석 해제 (앞의 # 제거)
:10,20s/^# //
```

### 데이터 추출

```vim
" 이메일 주소가 포함된 모든 줄 표시
:g/\w\+@\w\+\.\w\+/p

" 모든 HTML 태그 삭제
:%s/<[^>]*>//g

" snake_case를 camelCase로 변환
:%s/_\(\l\)/\u\1/g
```

---

## 10. 요약

| 범주 | 명령 | 설명 |
|----------|---------|-------------|
| 검색 | `/pattern`, `?pattern` | 앞/뒤 방향 검색 |
| 이동 | `n`, `N` | 다음/이전 일치 항목 |
| 단어 검색 | `*`, `#` | 커서 아래 단어 검색 |
| 치환 | `:%s/old/new/g` | 파일 전체에서 교체 |
| 확인 치환 | `:%s/old/new/gc` | 확인하면서 교체 |
| 범위 | `:10,20s/old/new/g` | 줄 범위 내에서 교체 |
| 전역 | `:g/pattern/command` | 일치하는 줄에서 실행 |
| 역 전역 | `:v/pattern/command` | 일치하지 않는 줄에서 실행 |
| 정규식 | `\v`, `\<\>`, `\(\)` | Very magic, 단어 경계, 그룹 |
| 하이라이트 | `:set hlsearch`, `:noh` | 일치 항목 하이라이트 전환 |

### 빠른 참조

```vim
" 가장 자주 쓰는 명령:
/word           " 'word' 찾기
*               " 커서 아래 단어 찾기
:%s/old/new/g   " 모두 교체
:%s/old/new/gc  " 확인하면서 교체
:g/pattern/d    " 일치하는 줄 삭제
:v/pattern/d    " 일치하지 않는 줄 삭제
```

---

## 연습 문제

### 연습 문제 1: 검색 내비게이션

여러 함수가 있는 Python 파일을 편집하고 있습니다. 각 작업의 정확한 키 시퀀스를 설명하세요:

1. `return` 단어를 앞 방향으로 검색합니다.
2. 다음 발생 위치로 이동합니다.
3. 이전 발생 위치로 돌아갑니다.
4. 커서 아래 단어(예: `calculate`)를 다시 입력하지 않고 검색합니다.

<details>
<summary>정답 보기</summary>

1. `/return`을 입력하고 `Enter` — `return`을 앞 방향으로 검색합니다.
2. `n`을 누릅니다 — 같은 방향으로 다음 일치 항목으로 이동합니다.
3. `N`을 누릅니다 — 이전 일치 항목으로 이동합니다 (방향 반전).
4. `*`를 누릅니다 — 커서 아래 단어를 완전한 단어로 앞 방향으로 검색합니다. `/\<calculate\>`와 동일하지만 입력이 필요 없습니다.

</details>

### 연습 문제 2: 치환 구문

각 작업에 대한 Vim 명령을 작성하세요:

1. 파일 전체에서 `foo`의 모든 발생을 `bar`로 교체합니다.
2. 파일 전체에서 `http://`를 `https://`로 교체합니다 (패턴에 슬래시가 있으므로 대체 구분자 사용).
3. 15번째 줄부터 30번째 줄까지만 `old_var`를 `new_var`로 교체합니다.
4. 현재 줄에서만 `DEBUG`를 `INFO`로 교체하되 매번 확인을 요청합니다.

<details>
<summary>정답 보기</summary>

1. `:%s/foo/bar/g`
2. `:s#http://#https://#g` 또는 `:%s|http://|https://|g` — `#` 또는 `|`를 구분자로 사용하면 URL의 `/`를 이스케이프할 필요가 없습니다.
3. `:15,30s/old_var/new_var/g`
4. `:s/DEBUG/INFO/gc` — `%`가 없으므로 현재 줄에만 적용됩니다; `c` 플래그는 각 치환을 확인합니다.

</details>

### 연습 문제 3: 전역 명령

`:g` 또는 `:v` 명령을 사용하여 각 작업에 대한 명령을 작성하세요:

1. `TODO` 단어가 포함된 모든 줄을 삭제합니다.
2. 모든 빈 줄(공백만 있거나 아무것도 없는 줄)을 삭제합니다.
3. `import`가 포함된 모든 줄을 표시(출력)합니다.
4. `def `가 포함되지 않은 모든 줄을 삭제합니다 (함수 정의 줄만 유지).

<details>
<summary>정답 보기</summary>

1. `:g/TODO/d`
2. `:g/^\s*$/d` — 시작(`^`)에서 끝(`$`)까지 공백 문자만 있는 줄을 일치시킵니다.
3. `:g/import/p` — `p` 명령은 일치하는 각 줄을 명령 영역에 출력합니다. (`:g/import/#`는 줄 번호도 표시합니다.)
4. `:v/def /d` — `:v`는 `:g`의 반대입니다; 일치하지 않는 줄을 삭제합니다.

</details>

### 연습 문제 4: 정규식 패턴 작성

각 변환에 대한 Vim 치환 명령을 작성하세요:

1. 파일의 모든 줄에서 후행 공백을 제거합니다.
2. 쉼표로 구분된 두 단어의 순서를 바꿉니다: `Smith, John`을 `John Smith`로 변환합니다 (캡처 그룹 사용).
3. `count`의 독립적인 발생만(`counter`, `discount` 등은 제외) `total`로 교체합니다.

<details>
<summary>정답 보기</summary>

1. `:%s/\s\+$//g` — `\s\+`는 하나 이상의 공백 문자를 일치시키고, `$`는 줄 끝에 고정합니다.
2. `:%s/\(\w\+\), \(\w\+\)/\2 \1/g` — `\(\w\+\)`는 첫 번째 단어(성)를 캡처하고, `, `는 구분자를 일치시키고, `\(\w\+\)`는 두 번째 단어(이름)를 캡처한 후 `\2 \1`로 순서를 바꿉니다.
   또는 very magic 모드: `:%s/\v(\w+), (\w+)/\2 \1/g`
3. `:%s/\<count\>/total/g` — `\<`와 `\>`는 단어 경계 앵커로 `count`가 완전한 단어로만 일치하도록 합니다.

</details>

### 연습 문제 5: 검색 및 교체 통합 워크플로우

JavaScript 파일에서 함수 `processData`를 `handleRequest`로 이름을 변경하려 합니다. 이 함수는 여러 곳에서 사용됩니다.

대화형 확인을 사용하는 가장 안전한 워크플로우를 설명하고, 각 확인 응답이 무엇을 하는지 설명하세요.

<details>
<summary>정답 보기</summary>

**명령**: `:%s/\<processData\>/handleRequest/gc`

**분석**:
- `%` — 파일 전체
- `s/` — 치환
- `\<processData\>` — 정확히 완전한 단어 `processData`를 일치 (단어 경계로 `processDataHelper` 등 방지)
- `/handleRequest/` — 교체 텍스트
- `gc` — 전역(줄당 모든 발생) + 각각 확인

**각 일치 항목에서 응답:**
- `y` — 이 발생을 교체 (확실할 때 사용)
- `n` — 이 발생을 건너뜀 (다른 변수이거나 의도적인 예외일 때)
- `a` — 나머지 모든 발생을 한 번에 교체 (충분히 검토하고 확신이 있을 때)
- `q` — 더 이상 교체하지 않고 종료 (실수를 발견했을 때)
- `l` — 이 항목을 교체하고 종료 (마지막으로 변경할 것일 때)

`\<...\>` 단어 경계는 안전성을 보장합니다 — `processData`를 포함한 `processDataHelper` 등 다른 식별자를 실수로 변경하지 않습니다.

</details>

---

**이전**: [비주얼 모드](./07_Visual_Mode.md) | **다음**: [레지스터, 마크, 매크로](./09_Registers_Marks_and_Macros.md)
